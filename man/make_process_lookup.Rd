% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utlis.R
\name{make_process_lookup}
\alias{make_process_lookup}
\title{Build Lookup Table from Group-State-Time to Design Row}
\usage{
make_process_lookup(
  proc,
  design,
  data,
  state_var = "f_tl",
  period_var = "f_tk"
)
}
\arguments{
\item{proc}{Name of the process (e.g., "phi", "p", "w").}

\item{design}{Output of `make_design_list_2()`.}

\item{data}{The original dataset.}

\item{state_var}{String name of the state variable (e.g., "f_tl").}

\item{period_var}{String name of the time variable (e.g., "f_tk").}
}
\value{
A list with:
- `lookup`: A `data.frame` with columns `g`, `state`, `time`, `design_row`, and `re_row`
- `X_min`: Minimal fixed-effect design matrix
- `Z_min`: Minimal random-effect design matrix (if applicable)
}
\description{
For a given process, generates a lookup table that maps combinations of
group, state, and time to row indices in the minimal design matrix.
This is required to populate full S2 or D2 arrays even when some
combinations are unobserved. Also returns Z_min and re_row if random effects are used.
}
\examples{
df <- data.frame(
  f_tk   = rep(1:5, each = 6),
  f_tl   = factor(sample(c("A", "B", "C"), 30, replace = TRUE)),
  f_yr   = factor(sample(2010:2012, 30, replace = TRUE)),
  f_site = factor(sample(1:3, 30, replace = TRUE))
)

formulas <- list(
  phi = ~ f_yr + (1|f_site),
  p   = ~ 1
)

design <- make_design_list_2(formulas, list(state = "f_tl", input = "f_tk"), df)
result <- make_process_lookup("phi", design, df, state_var = "f_tl", period_var = "f_tk")
head(result$lookup)
head(result$X_min)
head(result$Z_min)

}
