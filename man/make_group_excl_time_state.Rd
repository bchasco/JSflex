% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utlis.R
\name{make_group_excl_time_state}
\alias{make_group_excl_time_state}
\title{Construct Grouping Factor Excluding Time and (Optionally) State}
\usage{
make_group_excl_time_state(fml, data, period = "f_tk", state_var = NULL)
}
\arguments{
\item{fml}{A one‐ or two‐sided formula with fixed and/or random effects,
e.g. `~ f_yr + (1|f_site)`.}

\item{data}{A `data.frame` containing all variables referenced in `fml`.}

\item{period}{A string naming the period variable to exclude (default: `"f_tk"`).}

\item{state_var}{Optional string naming a state variable; if not `NULL`,
also excludes this variable (e.g., `"f_tl"`).}
}
\value{
A factor of length `nrow(data)` representing the interaction of all
  fixed and random effect variables in the formula, excluding `period` and
  (if specified) `state_var`. If no grouping variables remain, returns a
  single-level factor.
}
\description{
Builds an interaction-based grouping factor from all fixed‐ and random‐effect
variables in a formula, excluding the time (period) variable (e.g., `f_tk`) and,
optionally, a state variable (e.g., `f_tl`). This reduced grouping is essential
for determining the number of unique strata in process matrices such as
survival, entry, movement, or detection, when time and state are handled separately.
}
\examples{
# Sample data with time (f_tk), state (f_tl), and other covariates
df <- data.frame(
  f_tk   = rep(1:2, each = 6),
  f_tl   = rep(c("A", "B", "C"), times = 4),
  f_yr   = factor(rep(2010:2012, length.out = 12)),
  f_site = factor(rep(1:3, times = 4))
)

# 1) Drop only f_tk — group by f_tl, f_yr, f_site:
g1 <- make_group_excl_time_state(~ f_tl + f_yr + (1|f_site), df)
table(g1)

# 2) Drop f_tk and f_tl — group by f_yr and f_site:
g2 <- make_group_excl_time_state(~ f_tk + f_tl + f_yr + (1|f_site),
                                 df, period = "f_tk", state_var = "f_tl")
table(g2)

# 3) No remaining variables — returns single-level factor:
g3 <- make_group_excl_time_state(~ f_tk + f_tl, df, period = "f_tk", state_var = "f_tl")
table(g3)

}
