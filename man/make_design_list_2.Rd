% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utlis.R
\name{make_design_list_2}
\alias{make_design_list_2}
\title{Generate Design Matrices and Grouping Structures (v2)}
\usage{
make_design_list_2(formulas, input, data)
}
\arguments{
\item{formulas}{Named list of formulas, one per process.}

\item{input}{List with names `state` and `input` to identify state and period variables.}

\item{data}{Data frame containing all covariates used in formulas.}
}
\value{
A list containing components:
- formulas: Original formulas
- X_obs: Full fixed effect design matrices (for observations)
- X_group: Minimal fixed effect design matrices (one per group)
- Z_obs: Full random effect design matrices
- Z_group: Minimal random effect design matrices (one per group)
- group_factor: Full grouping factors
- group_noperiod: Grouping factors excluding period
- group_excl_time_state: Grouping excluding period AND state
- data: The input data used
}
\description{
Generates X and Z matrices, random effect terms, and grouping factors (including
full group, group without period, and group without period and state) for each
process in the supplied formulas. Also generates minimal design matrices for each
unique group level used to map process parameters into S2/D2 arrays.
}
\examples{
df <- data.frame(
  f_tk   = rep(1:5, each = 6),
  f_tl   = factor(sample(c("A", "B", "C"), 30, replace = TRUE)),
  f_yr   = factor(sample(2010:2012, 30, replace = TRUE)),
  f_site = factor(sample(1:3, 30, replace = TRUE))
)

formulas <- list(
  phi = ~ f_yr + (1|f_site),
  p   = ~ 1
)

design <- make_design_list_2(formulas, list(state = "f_tl", input = "f_tk"), df)
head(design$X_obs$phi)
head(design$X_group$phi)
head(design$Z_obs$phi)
head(design$Z_group$phi)

}
