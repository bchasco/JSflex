% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utlis.R
\name{make_RTMB_data_list}
\alias{make_RTMB_data_list}
\title{Construct RTMB Data List from Design and Capture Data}
\usage{
make_RTMB_data_list(design, data, state = NULL, period = "t_k")
}
\arguments{
\item{design}{A design list generated by \code{\link{make_design_list}()},
containing \code{X_list}, \code{Z_list}, \code{group_factor}, and
\code{group_noperiod} components.}

\item{data}{A \code{data.frame} of individual‐level capture data.  Must
include columns \code{t_k}, \code{r_k}, \code{t_l}, \code{f_tl},
\code{r_l}, \code{tag}, and \code{n}, plus any covariates used in
\code{design}.}

\item{state}{Optional string naming the state column (e.g., \code{"t_l"}).
If provided, \code{state} is stored in the output and used for spatial
summaries.}

\item{period}{Character. Column name for the period/time variable
(default: \code{"t_k"}); used to tabulate counts per time step.}
}
\value{
A named list with components:
\describe{
  \item{\code{t_k}, \code{r_k}, \code{t_l}, \code{f_tl}, \code{r_l}, \code{tag}, \code{n}}{Raw data vectors.}
  \item{\code{s}}{Maximum observed time or recapture index.}
  \item{\code{period_fac}}{Factor of the period variable.}
  \item{\code{X_list}, \code{Z_list}}{Design matrices from \code{design}.}
  \item{\code{group_factor}}{List of joint grouping factors.}
  \item{\code{phi_for_joint}, \code{p_for_joint}, \code{w_for_joint}, \code{tvar_for_joint}, \code{Nsuper_for_joint}}{Integer mappings from joint to process groups.}
  \item{\code{joint_group}, \code{Nsuper_group}}{Factors of joint and Nsuper groups.}
  \item{\code{G}, \code{K}}{Number of joint groups and number of Nsuper levels.}
  \item{\code{A}}{Membership matrix (K × G) mapping Nsuper levels to joint groups.}
  \item{\code{u}}{Vector of counts tagged per period.}
  \item{\code{uTot_g}}{Total counts per Nsuper group.}
  \item{\code{sp_pr}}{Spatial proportions of detections.}
  \item{\code{state}}{Same as input \code{state}.}
}
}
\description{
Centralizes construction of the full data list required by an RTMB model.
Pulls together observed capture histories, design matrices, grouping factors,
joint-to-process mappings, and auxiliary summaries (e.g., counts per time,
spatial proportions) into a single named list.
}
\examples{
# 1) Build a simple design for processes phi and p
formulas <- list(
  phi = ~ f_yr + (1|f_site),
  p   = ~ f_yr
)
df <- data.frame(
  f_yr   = factor(rep(2010:2011, each = 4)),
  f_site = factor(rep(1:4, times = 2)),
  t_k    = rep(1:4, times = 2),
  r_k    = rep(1:4, times = 2),
  t_l    = factor(rep(c("A","B","C","D"), times = 2)),
  f_tl   = factor(rep(c("A","B","C","D"), times = 2)),
  r_l    = factor(rep(1:4, times = 2)),
  tag    = 1:8,
  n      = sample(1:5, 8, replace = TRUE)
)

# 2) Create design list, dropping f_tl for group_noperiod
design <- make_design_list(formulas, state = "t_l", data = df)

# 3) Build RTMB data list
rtmb_data <- make_RTMB_data_list(design, df, state = "t_l", period = "t_k")

# Inspect key elements:
names(rtmb_data)
rtmb_data$G
head(rtmb_data$u)
rtmb_data$sp_pr

}
