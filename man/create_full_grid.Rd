% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utlis.R
\name{create_full_grid}
\alias{create_full_grid}
\title{Build a Full Design Grid for Any φ‐Formula}
\usage{
create_full_grid(phi_formula, data, state = NULL, period = "f_tk")
}
\arguments{
\item{phi_formula}{A one‐sided formula for φ, e.g. `~1 + f_sex + (1|f_tl)`.}

\item{data}{The original data frame (must contain all relevant columns).}

\item{state}{Optional name of the state variable (e.g. `"f_tl"`).}

\item{period}{Name of the period variable (e.g. `"f_tk"`).}
}
\value{
A data.frame whose columns include every factor in `phi_formula`,
  plus `state` and `period`, with one row per combination of their levels.
}
\description{
Given a φ‐formula that may include any number of fixed & random effects,
plus a state variable (`f_tl`) and a period variable (`f_tk`),
build a data.frame with one row per possible combination of:
  - every factor in the formula (fixed or grouping),
  - the full set of state levels, and
  - the full set of period values.
}
\examples{
# Suppose your data has factors f_sex (3 levels), f_tl (5 levels), f_tk in 1:17
full_grid <- create_full_grid(~ 1 + f_sex + (1|f_tl), d,
                             state = "f_tl", period = "f_tk")
dim(full_grid)
# 3 × 5 × 17 = 255 rows

# You can now do:
fe_phi <- lme4::nobars(~ 1 + f_sex + (1|f_tl))
X_full  <- model.matrix(fe_phi, full_grid)
bars    <- lme4::findbars(~ 1 + f_sex + (1|f_tl))
Z_full  <- t(as.matrix(lme4::mkReTrms(bars, full_grid)$Zt))
# X_full is 255×p,   Z_full is 255×q

}
